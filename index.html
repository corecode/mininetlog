<html>
  <head>
    <script src="http://dygraphs.com/dygraph-combined.js"></script>
  </head>
  <body>
    <div style="display: inline-block;
		position: relative;
		min-width: 20em;
		width: 75%;
		max-width: 50em;
		min-height: 10em;
		max-height: 100%;">
      <div style="padding-top: 65%"></div>
      <div id="chart" style="position: absolute;
			     top: 0;
			     bottom: 0;
			     left: 0;
			     right: 0;"></div>
    </div>
    <script type="text/javascript">
      // Fix up data, from raw bytes to bits/s
      var oldparsecsv = Dygraph.prototype.parseCSV_;
      Dygraph.prototype.parseCSV_ = function(csvdata) {
        var data = oldparsecsv.call(this, csvdata);
        var lasttime = 0;
        for (var i = 0; i < data.length; i++) {
          var col = data[i];
          for (var j = 1; j < col.length; j++) {
            col[j] *= 8 / ((col[0] - lasttime) / 1000);
          }
          lasttime = col[0];
        }
        return data;
      }
      function timeRange() {
        var now = new Date().valueOf();
        var start = now - 24*3600*1000;
        return [start, now];
      }
      var chartdiv = document.getElementById("chart");
      var g = new Dygraph(
        chartdiv,
        location.hash.replace("#", ""),
        {
          legend: 'always',
          labelsSeparateLines: true,
          labelsKMB: true,
          showRoller: true,
          rollPeriod: 5,
          dateWindow: timeRange(),
        });
      var timer = setInterval(function() {
        g.updateOptions({
          file: g.file_,
          dateWindow: timeRange()
        });
      }, 60*1000);
    </script>
  </body>
</html>
